--
--  ██████╗ ██████╗ ████████╗██╗ ██████╗ ███╗   ██╗███████╗
-- ██╔═══██╗██╔══██╗╚══██╔══╝██║██╔═══██╗████╗  ██║██╔════╝
-- ██║   ██║██████╔╝   ██║   ██║██║   ██║██╔██╗ ██║███████╗
-- ██║   ██║██╔═══╝    ██║   ██║██║   ██║██║╚██╗██║╚════██║
-- ╚██████╔╝██║        ██║   ██║╚██████╔╝██║ ╚████║███████║
--  ╚═════╝ ╚═╝        ╚═╝   ╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚══════╝
--
-- 功能：Neovim 基础核心配置（行号/缩进/交互/外观/插件适配）

-- ======================== 变量定义（基础铺垫） ========================
-- 简化配置书写：opt 操作编辑器全局选项（等价于 :set 命令），g 操作全局变量（给插件传参）
local opt = vim.opt
local g = vim.g

-- ======================== 行号配置（提升跳转效率） ========================
opt.relativenumber = true -- 启用相对行号：当前行显示0，上下行显示相对行数，快速跳转（如 2k/3j）
opt.number = true         -- 启用绝对行号：仅当前行显示实际行号，结合相对行号更易定位

-- ======================== 缩进配置（代码格式规范化） ========================
opt.tabstop = 4        -- 制表符（Tab）显示宽度：4个字符
opt.shiftwidth = 4     -- 自动缩进/换行时的缩进量：4个字符
opt.softtabstop = 4    -- 退格键单次删除空格数：4个字符（匹配缩进量）
opt.expandtab = true   -- Tab键输入转换为空格：避免不同编辑器Tab宽度不一致
opt.autoindent = true  -- 基础自动缩进：新行继承上一行缩进级别
opt.smartindent = true -- 智能缩进：根据代码语法自动调整（如if/for块内自动加缩进）

-- ======================== 交互配置（提升操作便捷性） ========================
opt.cursorline = true -- 高亮光标所在行：快速定位光标位置（代码行数多时更实用）
opt.mouse:append("a") -- 启用鼠标全模式支持：普通/插入/视觉/终端模式均可使用鼠标

-- ======================== 按键超时配置（适配组合键） ========================
vim.o.timeoutlen = 500 -- 组合键（如Leader键）响应超时：500ms（兼顾速度和容错）

-- ======================== 剪贴板配置（打通系统剪贴板） ========================
opt.clipboard:append("unnamedplus") -- 绑定系统剪贴板：复制/粘贴直接使用系统剪贴板

-- ======================== 窗口分割配置（符合操作习惯） ========================
opt.splitright = true -- 垂直分割窗口：新窗口默认在右侧（常规操作逻辑）
opt.splitbelow = true -- 水平分割窗口：新窗口默认在下方

-- ======================== 搜索配置（智能匹配） ========================
opt.ignorecase = true -- 搜索默认忽略大小写：模糊搜索更便捷
opt.smartcase = true  -- 智能大小写：搜索词含大写时，自动区分大小写（精准匹配）

-- ======================== 外观配置（视觉体验优化） ========================
opt.termguicolors = true -- 启用真彩色：主题颜色更丰富（需终端支持真彩色）
opt.signcolumn = "yes"   -- 始终显示左侧符号列：用于断点/错误提示，避免窗口跳动

-- ======================== 插件前置配置（兼容第三方文件管理器） ========================
g.loaded_netrw = 1       -- 禁用内置netrw文件管理器：为neo-tree/nvim-tree让路
g.loaded_netrwPlugin = 1 -- 彻底禁用netrw插件：避免和第三方文件管理器冲突

-- ======================== 自动跳转上次编辑位置（人性化优化） ========================
vim.api.nvim_create_autocmd("BufReadPost", {
    pattern = "*",                                     -- 匹配所有文件
    callback = function()
        local mark = vim.api.nvim_buf_get_mark(0, '"') -- 获取上次编辑位置标记
        local lcount = vim.api.nvim_buf_line_count(0)  -- 获取当前文件总行数
        -- 标记有效时跳转（行号合法，不超出文件范围）
        if mark[1] > 0 and mark[1] <= lcount then
            pcall(vim.api.nvim_win_set_cursor, 0, mark) -- 保护调用，避免报错
        end
    end,
})

-- ======================== NeoTree 样式配置（视觉美化） ========================
vim.api.nvim_set_hl(0, "NeoTreeNormal", { bg = "NONE" })   -- NeoTree正常窗口背景透明
vim.api.nvim_set_hl(0, "NeoTreeNormalNC", { bg = "NONE" }) -- NeoTree非活动窗口背景透明

-- ======================== 工作目录配置（路径操作便捷性） ========================
vim.o.autochdir = true -- 自动切换工作目录：切换为当前打开文件的所在目录，执行命令更直观

-- ======================== 代码折叠配置（基于TreeSitter） ========================
opt.foldmethod = 'indent'                   -- 折叠方式：基于缩进（相同缩进归为一组）
opt.foldexpr = 'nvim_treesitter#foldexpr()' -- 折叠表达式：用TreeSitter计算（更智能）
opt.foldlevel = 50                          -- 折叠级别：50（几乎不折叠，仅深层代码折叠）
opt.foldlevelstart = 50                     -- 打开文件时默认不折叠：避免代码被隐藏
opt.foldcolumn = '1'                        -- 显示折叠列：宽度1字符（显示±符号，方便操作）
